<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thêm mới tài sản - MISA</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .header {
            background: #fff;
            padding: 16px 24px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        .header-actions {
            display: flex;
            gap: 12px;
        }
        .btn {
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            border: none;
            transition: all 0.2s;
        }
        .btn-cancel {
            background: #fff;
            color: #666;
            border: 1px solid #ccc;
        }
        .btn-cancel:hover {
            background: #f5f5f5;
            border-color: #999;
        }
        .btn-save-add {
            background: #fff;
            color: #17a2b8;
            border: 1px solid #17a2b8;
        }
        .btn-save-add:hover {
            background: #e6f7f9;
        }
        .btn-save {
            background: #17a2b8;
            color: #ffffff;
        }
        .btn-save:hover {
            background: #138496;
        }
        .content-wrapper {
            display: flex;
            height: calc(100vh - 120px);
        }
        .sidebar {
            width: 220px;
            background: #f9f9f9;
            border-right: 1px solid #e0e0e0;
            padding: 16px 0;
        }
        .tab-item {
            padding: 12px 24px;
            color: #555;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .tab-item:hover {
            background: #f0f0f0;
        }
        .tab-item.active {
            background: #e6f7f9;
            color: #17a2b8;
            font-weight: 600;
            border-left: 3px solid #17a2b8;
        }
        .main-content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }
        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e0e0e0;
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .form-group {
            display: flex;
            flex-direction: column;
            margin-bottom: 20px;
        }
        .form-label {
            font-size: 13px;
            color: #333;
            margin-bottom: 8px;
            font-weight: 500;
        }
        .form-label .required {
            color: #dc3545;
            margin-left: 2px;
        }
        .form-input, .form-select {
            padding: 10px 12px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 13px;
            outline: none;
            transition: border-color 0.2s;
        }
        .form-input:focus, .form-select:focus {
            border-color: #17a2b8;
            border-width: 2px;
            padding: 9px 11px;
        }
        .form-input:disabled {
            background-color: #f5f5f5;
            cursor: not-allowed;
        }
        .form-select {
            cursor: pointer;
            background: white;
            appearance: none;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23333' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 12px center;
            padding-right: 36px;
        }
        .input-with-action {
            display: flex;
            gap: 8px;
        }
        .input-with-action .form-select,
        .input-with-action .form-input {
            flex: 1;
        }
        .btn-icon {
            background: #fff;
            border: 1px solid #ccc;
            color: #666;
            padding: 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            min-width: 40px;
            transition: all 0.2s;
        }
        .btn-icon:hover {
            background: #f5f5f5;
            border-color: #999;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .info-row {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #666;
            font-size: 13px;
            margin-bottom: 12px;
        }
        .info-icon {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #e9ecef;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: #666;
        }
        .depreciation-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
            margin-top: 16px;
        }
        .depreciation-table thead {
            background-color: #8b0000;
            color: white;
        }
        .depreciation-table th {
            border: 1px solid #e0e0e0;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        .depreciation-table td {
            border: 1px solid #e0e0e0;
            padding: 10px 12px;
            color: #555;
        }
        .depreciation-table input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 12px;
        }
        .btn-add-row {
            background: transparent;
            border: none;
            color: #17a2b8;
            padding: 8px 0;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 8px;
        }
        .btn-add-row:hover {
            color: #138496;
        }
        .btn-delete-row {
            background: transparent;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 16px;
            padding: 2px 6px;
        }
        .btn-delete-row:hover {
            color: #a71d2a;
        }
        .allocation-form-row {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr 40px;
            gap: 12px;
            margin-bottom: 16px;
            align-items: end;
        }
        .allocation-form-row .form-group {
            margin-bottom: 0;
        }
        .layout-section {
            padding: 20px;
            background: #f8f9fa;
            border-radius: 6px;
            margin-top: 16px;
        }
        .radio-group {
            display: flex;
            gap: 24px;
            margin-top: 8px;
        }
        .radio-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-size: 14px;
        }
        .radio-group input[type="radio"] {
            cursor: pointer;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>Thêm mới tài sản</h1>
        <div class="header-actions">
            <button class="btn btn-cancel">Hủy</button>
            <button class="btn btn-save-add">Lưu và thêm mới</button>
            <button class="btn btn-save">Lưu</button>
        </div>
    </div>

    <div class="content-wrapper">
        <div class="sidebar">
            <div class="tab-item active" data-tab="general">Thông tin chung</div>
            <div class="tab-item" data-tab="layout_info">Thông tin bố cục</div>
            <div class="tab-item" data-tab="warranty">Bảo hành</div>
            <div class="tab-item" data-tab="depreciation">Đã cấp phát</div>
            <div class="tab-item" data-tab="layout">Thông tin phân bổ</div>
            <div class="tab-item" data-tab="supplier">Nhà cung cấp bổ sung</div>
            <div class="tab-item" data-tab="attachments">Tệp đính kèm</div>
            <div class="tab-item" data-tab="other">Thông tin khác</div>
        </div>

        <div class="main-content">
            <!-- Thông tin chung -->
            <div class="tab-content active" id="general">
                <div class="section-title">Thông tin chung</div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">
                            Đơn vị quản lý <span class="required">*</span>
                        </label>
                        <div class="input-with-action">
                            <select class="form-select">
                                <option selected>CÔNG TY CỔ PHẦN CÔNG NGHỆ BOTA</option>
                                <option>Chi nhánh Hà Nội</option>
                                <option>Chi nhánh TP.HCM</option>
                            </select>
                            <button class="btn-icon">⋯</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Vị trí tài sản</label>
                        <div class="input-with-action">
                            <select class="form-select">
                                <option value="">Chọn vị trí</option>
                                <option>Phòng IT</option>
                                <option>Phòng kế toán</option>
                                <option>Kho</option>
                            </select>
                            <button class="btn-icon">⋯</button>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Người quản lý <span class="required">*</span></label>
                        <div class="input-with-action">
                            <select class="form-select">
                                <option>Vũ Công Nam (NV000001)</option>
                                <option>Nguyễn Văn A (NV000002)</option>
                            </select>
                            <button class="btn-icon">⋯</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Nguồn gốc</label>
                        <select class="form-select">
                            <option value="">Chọn nguồn gốc</option>
                            <option>Mua mới</option>
                            <option>Nhập khẩu</option>
                            <option>Tự sản xuất</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Loại tài sản <span class="required">*</span></label>
                        <div class="input-with-action">
                            <select class="form-select">
                                <option value="">Chọn loại tài sản</option>
                                <option>Máy tính</option>
                                <option>Thiết bị văn phòng</option>
                                <option>Xe cộ</option>
                            </select>
                            <button class="btn-icon">⋯</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Ngày mua <span class="required">*</span></label>
                        <input type="date" class="form-input" value="2025-10-14">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Tên tài sản <span class="required">*</span></label>
                        <input type="text" class="form-input" placeholder="Nhập tên tài sản">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Số hợp đồng</label>
                        <input type="text" class="form-input" placeholder="Nhập số hợp đồng">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Mã tài sản <span class="required">*</span></label>
                        <input type="text" class="form-input" value=".00001">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Nhà cung cấp</label>
                        <div class="input-with-action">
                            <select class="form-select">
                                <option value="">Chọn nhà cung cấp</option>
                                <option>Công ty A</option>
                                <option>Công ty B</option>
                            </select>
                            <button class="btn-icon">⋯</button>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Số lượng</label>
                        <input type="number" class="form-input" value="1" disabled>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Số serial</label>
                        <input type="text" class="form-input" placeholder="Nhập số serial">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Đơn vị tính</label>
                        <div class="input-with-action">
                            <select class="form-select">
                                <option value="">Chọn đơn vị tính</option>
                                <option>Cái</option>
                                <option>Chiếc</option>
                                <option>Bộ</option>
                            </select>
                            <button class="btn-icon">⋯</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Quy cách tài sản</label>
                        <textarea class="form-input" rows="3" placeholder="Nhập quy cách"></textarea>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Giá trị</label>
                        <div style="display: flex; gap: 8px;">
                            <input type="number" class="form-input" placeholder="0" style="flex: 1;">
                            <select class="form-select" style="width: 100px;">
                                <option>VND</option>
                                <option>USD</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="checkbox">
                        <span class="form-label" style="margin: 0;">Là tài sản có định</span>
                        <span class="info-icon">i</span>
                    </label>
                </div>
            </div>

            <!-- Thông tin bố cục -->
            <div class="tab-content" id="layout_info">
                <div class="section-title">Thông tin bố cục</div>

                <!-- Radio chọn loại bố cục -->
                <div class="form-group" style="margin-bottom: 24px;">
                    <label class="form-label">Loại bố cục <span class="required">*</span></label>
                    <div class="radio-group">
                        <label>
                            <input type="radio" name="layoutType" value="factory" checked>
                            <span>Bố cục nhà máy</span>
                        </label>
                        <label>
                            <input type="radio" name="layoutType" value="office">
                            <span>Bố cục văn phòng</span>
                        </label>
                    </div>
                </div>

                <!-- Bố cục nhà máy (5 cấp) -->
                <div id="factoryLayout" class="layout-section">
                    <div class="info-row">
                        <span class="info-icon">i</span>
                        <span>Chọn bố cục phân cấp: Plant → Zone → Workshop → Line → Station (Có thể dừng ở bất kỳ cấp nào)</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Plant (Nhà máy) <span class="required">*</span></label>
                        <div class="input-with-action">
                            <select class="form-select" id="plantSelect">
                                <option value="">Chọn Plant</option>
                                <option value="PL-DLF">PL-DLF - Nhà máy Gạm cháy Đại Long</option>
                                <option value="PL-HN">PL-HN - Nhà máy Hà Nội</option>
                                <option value="PL-DN">PL-DN - Nhà máy Đà Nẵng</option>
                            </select>
                            <button class="btn-icon" type="button">⋯</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Zone (Khu vực)</label>
                        <div class="input-with-action">
                            <select class="form-select" id="zoneSelect" disabled>
                                <option value="">Chọn Zone</option>
                            </select>
                            <button class="btn-icon" type="button" disabled>⋯</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Workshop (Xưởng)</label>
                        <div class="input-with-action">
                            <select class="form-select" id="workshopSelect" disabled>
                                <option value="">Chọn Workshop</option>
                            </select>
                            <button class="btn-icon" type="button" disabled>⋯</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Line (Chuyền sản xuất)</label>
                        <div class="input-with-action">
                            <select class="form-select" id="lineSelect" disabled>
                                <option value="">Chọn Line</option>
                            </select>
                            <button class="btn-icon" type="button" disabled>⋯</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Station (Trạm)</label>
                        <div class="input-with-action">
                            <select class="form-select" id="stationSelect" disabled>
                                <option value="">Chọn Station</option>
                            </select>
                            <button class="btn-icon" type="button" disabled>⋯</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Location Path</label>
                        <input type="text" class="form-input" id="fullCode" readonly style="background-color: #e9ecef; font-weight: 600; color: #495057;">
                    </div>
                </div>

                <!-- Bố cục văn phòng -->
                <div id="officeLayout" class="layout-section" style="display: none;">
                    <div class="info-row">
                        <span class="info-icon">i</span>
                        <span>Nhập thông tin bố cục văn phòng</span>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Tòa nhà <span class="required">*</span></label>
                        <div class="input-with-action">
                            <select class="form-select">
                                <option value="">Chọn tòa nhà</option>
                                <option>Tòa nhà A</option>
                                <option>Tòa nhà B</option>
                                <option>Tòa nhà C</option>
                            </select>
                            <button class="btn-icon">⋯</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Tầng <span class="required">*</span></label>
                        <select class="form-select">
                            <option value="">Chọn tầng</option>
                            <option>Tầng 1</option>
                            <option>Tầng 2</option>
                            <option>Tầng 3</option>
                            <option>Tầng 4</option>
                            <option>Tầng 5</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Phòng ban <span class="required">*</span></label>
                        <div class="input-with-action">
                            <select class="form-select">
                                <option value="">Chọn phòng ban</option>
                                <option>Phòng IT</option>
                                <option>Phòng kế toán</option>
                                <option>Phòng nhân sự</option>
                                <option>Phòng kinh doanh</option>
                            </select>
                            <button class="btn-icon">⋯</button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Vị trí cụ thể</label>
                        <input type="text" class="form-input" placeholder="VD: Bàn 5, khu A">
                    </div>
                </div>

                <!-- Thông tin bổ sung -->
                <div class="section-title" style="margin-top: 32px;">Thông tin bổ sung</div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Đặc điểm kỹ thuật</label>
                        <input type="text" class="form-input" placeholder="Nhập đặc điểm kỹ thuật">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Commission Date</label>
                        <input type="date" class="form-input">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Trạng thái</label>
                        <select class="form-select">
                            <option value="">Chọn trạng thái</option>
                            <option>Mới</option>
                            <option>Cũ</option>
                            <option>Vẫn duy trì</option>
                            <option>Hết hạn sử dụng</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Bảo hành -->
            <div class="tab-content" id="warranty">
                <div class="section-title">Bảo hành</div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Thời gian bảo hành</label>
                        <div style="display: flex; gap: 8px;">
                            <input type="number" class="form-input" placeholder="0" style="flex: 1;">
                            <select class="form-select" style="width: 100px;">
                                <option>Tháng</option>
                                <option>Năm</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Điều kiện bảo hành</label>
                        <textarea class="form-input" rows="3" placeholder="Nhập điều kiện bảo hành"></textarea>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Hạn bảo hành</label>
                        <input type="date" class="form-input" placeholder="dd/mm/yyyy">
                    </div>
                </div>
            </div>

            <!-- Đã cấp phát (Depreciation Table) -->
            <div class="tab-content" id="depreciation">
                <div class="section-title">Bảng tính khấu hao</div>

                <table class="depreciation-table">
                    <thead>
                    <tr>
                        <th>Spec</th>
                        <th>CommissionDate</th>
                        <th>Status</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td>380/11kw</td>
                        <td>25/01/2024</td>
                        <td>Cũ / Vẫn duy trì</td>
                    </tr>
                    <tr>
                        <td>380/4kw</td>
                        <td>25/01/2024</td>
                        <td>Cũ / Vẫn duy trì</td>
                    </tr>
                    <tr>
                        <td>380/2.2kw</td>
                        <td>25/01/2024</td>
                        <td>Cũ / Vẫn duy trì</td>
                    </tr>
                    <tr>
                        <td>380/1.5kw</td>
                        <td>25/01/2024</td>
                        <td>Cũ / Vẫn duy trì</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td></td>
                        <td>Cũ / Vẫn duy trì</td>
                    </tr>
                    <tr>
                        <td></td>
                        <td>25/01/2024</td>
                        <td>Cũ / Vẫn duy trì</td>
                    </tr>
                    <tr>
                        <td>6kg</td>
                        <td>25/01/2024</td>
                        <td>Cũ / Vẫn duy trì</td>
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- Thông tin phân bổ -->
            <div class="tab-content" id="layout">
                <div class="section-title">Thông tin phân bổ</div>

                <div class="info-row">
                    <span class="info-icon">i</span>
                    <span>Thông tin phân bổ chi phí khấu hao của tài sản</span>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Giá trị tính phân bổ</label>
                        <input type="number" class="form-input" value="0" placeholder="0">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Số kỳ phân bổ còn lại</label>
                        <div style="display: flex; gap: 8px;">
                            <input type="number" class="form-input" placeholder="0" style="flex: 1;">
                            <select class="form-select" style="width: 100px;">
                                <option>Tháng</option>
                                <option>Năm</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Số kỳ phân bổ</label>
                        <div style="display: flex; gap: 8px;">
                            <input type="number" class="form-input" placeholder="0" style="flex: 1;">
                            <select class="form-select" style="width: 100px;">
                                <option>Tháng</option>
                                <option>Năm</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Giá trị đã phân bổ</label>
                        <input type="number" class="form-input" value="0" placeholder="0">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Ngày bắt đầu phân bổ</label>
                        <input type="date" class="form-input" value="2025-10-14">
                    </div>

                    <div class="form-group">
                        <label class="form-label">Giá trị còn chờ phân bổ</label>
                        <input type="number" class="form-input" value="0" placeholder="0">
                    </div>
                </div>

                <div class="section-title" style="margin-top: 32px;">Thông tin bố cục</div>

                <div id="allocationFormsContainer">
                    <p style="color: #999; text-align: center; padding: 20px;">Chưa có dữ liệu</p>
                </div>

                <button type="button" class="btn-add-row" id="addAllocationRow">
                    + Thêm dòng
                </button>

                <div class="section-title" style="margin-top: 32px;">Đã cấp phát</div>

                <div class="form-group" style="margin-bottom: 16px;">
                    <label style="display: flex; align-items: center; gap: 8px;">
                        <input type="checkbox" id="dailyAllocation">
                        <span class="form-label" style="margin: 0;">Đã cấp phát ngày</span>
                    </label>
                    <input type="date" class="form-input" style="margin-top: 8px; max-width: 300px;" disabled>
                </div>

                <div class="form-group">
                    <label class="form-label">Vị trí công việc</label>
                    <input type="text" class="form-input" placeholder="Nhập vị trí công việc">
                </div>
            </div>

            <!-- Other tabs -->
            <div class="tab-content" id="supplier">
                <div class="section-title">Nhà cung cấp bổ sung</div>
                <p style="color: #999; text-align: center; padding: 40px;">Nội dung đang được phát triển</p>
            </div>

            <div class="tab-content" id="attachments">
                <div class="section-title">Tệp đính kèm</div>
                <p style="color: #999; text-align: center; padding: 40px;">Nội dung đang được phát triển</p>
            </div>

            <div class="tab-content" id="other">
                <div class="section-title">Thông tin khác</div>
                <p style="color: #999; text-align: center; padding: 40px;">Nội dung đang được phát triển</p>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function() {
        let allocationRows = [];

        // Dữ liệu phân cấp nhà máy
        const factoryData = {
            'PL-DLF': {
                name: 'Nhà máy Gạm cháy Đại Long',
                zones: {
                    'ZN-BOIL-01': {
                        name: 'Khu vực Boiler 01',
                        workshops: {
                            'WS-01': {
                                name: 'Xưởng 01',
                                lines: {
                                    'LX-CDRY-01': {
                                        name: 'Chuyền sấy 01',
                                        stations: {
                                            'ST-BURN-01': 'Trạm đốt 01',
                                            'ST-BURN-02': 'Trạm đốt 02',
                                            'ST-COOL-01': 'Trạm làm mát 01'
                                        }
                                    },
                                    'LX-CDRY-02': {
                                        name: 'Chuyền sấy 02',
                                        stations: {
                                            'ST-BURN-03': 'Trạm đốt 03',
                                            'ST-COOL-02': 'Trạm làm mát 02'
                                        }
                                    }
                                }
                            },
                            'WS-02': {
                                name: 'Xưởng 02',
                                lines: {
                                    'LX-PACK-01': {
                                        name: 'Chuyền đóng gói 01',
                                        stations: {
                                            'ST-PACK-01': 'Trạm đóng gói 01',
                                            'ST-SEAL-01': 'Trạm niêm phong 01'
                                        }
                                    }
                                }
                            }
                        }
                    },
                    'ZN-PACK-01': {
                        name: 'Khu vực đóng gói',
                        workshops: {
                            'WS-03': {
                                name: 'Xưởng đóng gói 03',
                                lines: {
                                    'LX-PACK-02': {
                                        name: 'Chuyền đóng gói 02',
                                        stations: {
                                            'ST-PACK-02': 'Trạm đóng gói 02'
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            },
            'PL-HN': {
                name: 'Nhà máy Hà Nội',
                zones: {
                    'ZN-PROD-01': {
                        name: 'Khu vực sản xuất 01',
                        workshops: {
                            'WS-HN-01': {
                                name: 'Xưởng Hà Nội 01',
                                lines: {
                                    'LX-HN-01': {
                                        name: 'Chuyền HN 01',
                                        stations: {
                                            'ST-HN-01': 'Trạm HN 01',
                                            'ST-HN-02': 'Trạm HN 02'
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            },
            'PL-DN': {
                name: 'Nhà máy Đà Nẵng',
                zones: {
                    'ZN-DN-01': {
                        name: 'Khu vực Đà Nẵng 01',
                        workshops: {
                            'WS-DN-01': {
                                name: 'Xưởng Đà Nẵng 01',
                                lines: {
                                    'LX-DN-01': {
                                        name: 'Chuyền DN 01',
                                        stations: {
                                            'ST-DN-01': 'Trạm DN 01'
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        };

        // Tab switching
        $('.tab-item').on('click', function() {
            const tabId = $(this).data('tab');

            $('.tab-item').removeClass('active');
            $(this).addClass('active');

            $('.tab-content').removeClass('active');
            $('#' + tabId).addClass('active');
        });

        // Xử lý chuyển đổi radio button bố cục
        $('input[name="layoutType"]').on('change', function() {
            if ($(this).val() === 'factory') {
                $('#factoryLayout').show();
                $('#officeLayout').hide();
            } else {
                $('#factoryLayout').hide();
                $('#officeLayout').show();
            }
        });

        // Xử lý chọn Plant
        $('#plantSelect').on('change', function() {
            const plantCode = $(this).val();

            console.log('Plant selected:', plantCode);
            console.log('Factory data:', factoryData);

            // Reset các cấp dưới
            $('#zoneSelect').html('<option value="">Chọn Zone</option>').prop('disabled', true).val('');
            $('#workshopSelect').html('<option value="">Chọn Workshop</option>').prop('disabled', true).val('');
            $('#lineSelect').html('<option value="">Chọn Line</option>').prop('disabled', true).val('');
            $('#stationSelect').html('<option value="">Chọn Station</option>').prop('disabled', true).val('');

            $('#zoneSelect').next('.btn-icon').prop('disabled', true);
            $('#workshopSelect').next('.btn-icon').prop('disabled', true);
            $('#lineSelect').next('.btn-icon').prop('disabled', true);
            $('#stationSelect').next('.btn-icon').prop('disabled', true);

            if (plantCode && factoryData[plantCode]) {
                const zones = factoryData[plantCode].zones;
                console.log('Zones found:', zones);

                let zoneOptions = '<option value="">Chọn Zone</option>';
                for (let zoneCode in zones) {
                    zoneOptions += `<option value="${zoneCode}">${zoneCode} - ${zones[zoneCode].name}</option>`;
                }

                console.log('Zone options:', zoneOptions);
                $('#zoneSelect').html(zoneOptions).prop('disabled', false);
                $('#zoneSelect').next('.btn-icon').prop('disabled', false);
            }

            updateFullCode();
        });

        // Xử lý chọn Zone
        $('#zoneSelect').on('change', function() {
            const plantCode = $('#plantSelect').val();
            const zoneCode = $(this).val();

            console.log('Zone selected:', zoneCode);

            // Reset các cấp dưới
            $('#workshopSelect').html('<option value="">Chọn Workshop</option>').prop('disabled', true).val('');
            $('#lineSelect').html('<option value="">Chọn Line</option>').prop('disabled', true).val('');
            $('#stationSelect').html('<option value="">Chọn Station</option>').prop('disabled', true).val('');

            $('#workshopSelect').next('.btn-icon').prop('disabled', true);
            $('#lineSelect').next('.btn-icon').prop('disabled', true);
            $('#stationSelect').next('.btn-icon').prop('disabled', true);

            if (zoneCode && factoryData[plantCode] && factoryData[plantCode].zones[zoneCode]) {
                const workshops = factoryData[plantCode].zones[zoneCode].workshops;
                console.log('Workshops found:', workshops);

                let workshopOptions = '<option value="">Chọn Workshop</option>';
                for (let wsCode in workshops) {
                    workshopOptions += `<option value="${wsCode}">${wsCode} - ${workshops[wsCode].name}</option>`;
                }

                $('#workshopSelect').html(workshopOptions).prop('disabled', false);
                $('#workshopSelect').next('.btn-icon').prop('disabled', false);
            }

            updateFullCode();
        });

        // Xử lý chọn Workshop
        $('#workshopSelect').on('change', function() {
            const plantCode = $('#plantSelect').val();
            const zoneCode = $('#zoneSelect').val();
            const workshopCode = $(this).val();

            console.log('Workshop selected:', workshopCode);

            // Reset các cấp dưới
            $('#lineSelect').html('<option value="">Chọn Line</option>').prop('disabled', true).val('');
            $('#stationSelect').html('<option value="">Chọn Station</option>').prop('disabled', true).val('');

            $('#lineSelect').next('.btn-icon').prop('disabled', true);
            $('#stationSelect').next('.btn-icon').prop('disabled', true);

            if (workshopCode && factoryData[plantCode] && factoryData[plantCode].zones[zoneCode] && factoryData[plantCode].zones[zoneCode].workshops[workshopCode]) {
                const lines = factoryData[plantCode].zones[zoneCode].workshops[workshopCode].lines;
                console.log('Lines found:', lines);

                let lineOptions = '<option value="">Chọn Line</option>';
                for (let lineCode in lines) {
                    lineOptions += `<option value="${lineCode}">${lineCode} - ${lines[lineCode].name}</option>`;
                }

                $('#lineSelect').html(lineOptions).prop('disabled', false);
                $('#lineSelect').next('.btn-icon').prop('disabled', false);
            }

            updateFullCode();
        });

        // Xử lý chọn Line
        $('#lineSelect').on('change', function() {
            const plantCode = $('#plantSelect').val();
            const zoneCode = $('#zoneSelect').val();
            const workshopCode = $('#workshopSelect').val();
            const lineCode = $(this).val();

            console.log('Line selected:', lineCode);

            // Reset Station
            $('#stationSelect').html('<option value="">Chọn Station</option>').prop('disabled', true).val('');
            $('#stationSelect').next('.btn-icon').prop('disabled', true);

            if (lineCode && factoryData[plantCode] && factoryData[plantCode].zones[zoneCode] && factoryData[plantCode].zones[zoneCode].workshops[workshopCode] && factoryData[plantCode].zones[zoneCode].workshops[workshopCode].lines[lineCode]) {
                const stations = factoryData[plantCode].zones[zoneCode].workshops[workshopCode].lines[lineCode].stations;
                console.log('Stations found:', stations);

                let stationOptions = '<option value="">Chọn Station</option>';
                for (let stCode in stations) {
                    stationOptions += `<option value="${stCode}">${stCode} - ${stations[stCode]}</option>`;
                }

                $('#stationSelect').html(stationOptions).prop('disabled', false);
                $('#stationSelect').next('.btn-icon').prop('disabled', false);
            }

            updateFullCode();
        });

        // Xử lý chọn Station
        $('#stationSelect').on('change', function() {
            updateFullCode();
        });

        // Cập nhật mã đầy đủ
        function updateFullCode() {
            const plant = $('#plantSelect').val();
            const zone = $('#zoneSelect').val();
            const workshop = $('#workshopSelect').val();
            const line = $('#lineSelect').val();
            const station = $('#stationSelect').val();

            let parts = [];
            if (plant) parts.push(plant);
            if (zone) parts.push(zone);
            if (workshop) parts.push(workshop);
            if (line) parts.push(line);
            if (station) parts.push(station);

            $('#fullCode').val(parts.join(' / '));
        }

        // Daily allocation checkbox
        $('#dailyAllocation').on('change', function() {
            $(this).closest('.form-group').find('input[type="date"]').prop('disabled', !this.checked);
        });

        // Add allocation row
        $('#addAllocationRow').on('click', function() {
            const newRow = {
                id: Date.now(),
                spec: '',
                commissionDate: '',
                status: ''
            };
            allocationRows.push(newRow);
            renderAllocationTable();
        });

        // Render allocation table
        function renderAllocationTable() {
            const container = $('#allocationFormsContainer');

            if (allocationRows.length === 0) {
                container.html(`
                    <p style="color: #999; text-align: center; padding: 20px;">Chưa có dữ liệu</p>
                `);
                return;
            }

            let html = '';
            allocationRows.forEach((row, index) => {
                html += `
                    <div class="allocation-form-row">
                        <div class="form-group">
                            <label class="form-label">Thông tin bố cục</label>
                            <input type="text" class="form-input allocation-spec" data-id="${row.id}"
                                   value="${row.spec}" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Thông tin bố cục</label>
                            <input type="text" class="form-input allocation-date" data-id="${row.id}"
                                   value="${row.commissionDate}" placeholder="0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Thông tin bố cục</label>
                            <div style="display: flex; gap: 8px;">
                                <input type="text" class="form-input allocation-status" data-id="${row.id}"
                                       value="${row.status}" placeholder="0" style="flex: 1;">
                                <select class="form-select" style="width: 100px;">
                                    <option>Tháng</option>
                                    <option>Năm</option>
                                </select>
                            </div>
                        </div>
                        <button type="button" class="btn-delete-row" data-id="${row.id}" style="height: 42px; margin-bottom: 0;" title="Xóa">×</button>
                    </div>
                `;
            });
            container.html(html);
        }

        // Handle allocation table inputs
        $(document).on('input', '.allocation-spec', function() {
            const id = $(this).data('id');
            const row = allocationRows.find(r => r.id === id);
            if (row) row.spec = $(this).val();
        });

        $(document).on('change', '.allocation-date', function() {
            const id = $(this).data('id');
            const row = allocationRows.find(r => r.id === id);
            if (row) row.commissionDate = $(this).val();
        });

        $(document).on('input', '.allocation-status', function() {
            const id = $(this).data('id');
            const row = allocationRows.find(r => r.id === id);
            if (row) row.status = $(this).val();
        });

        $(document).on('click', '.btn-delete-row', function() {
            const id = $(this).data('id');
            allocationRows = allocationRows.filter(r => r.id !== id);
            renderAllocationTable();
        });

        // Button actions
        $('.btn-cancel').on('click', function() {
            if (confirm('Bạn có chắc chắn muốn hủy? Các thay đổi sẽ không được lưu.')) {
                window.history.back();
            }
        });

        $('.btn-save, .btn-save-add').on('click', function() {
            // Validate form - chỉ cần Plant là bắt buộc
            const layoutType = $('input[name="layoutType"]:checked').val();

            if (layoutType === 'factory') {
                const plantCode = $('#plantSelect').val();

                if (!plantCode) {
                    alert('Vui lòng chọn Plant (Nhà máy)');
                    return;
                }

                // Lấy thông tin bố cục đã chọn
                const layoutInfo = {
                    plant: plantCode,
                    zone: $('#zoneSelect').val(),
                    workshop: $('#workshopSelect').val(),
                    line: $('#lineSelect').val(),
                    station: $('#stationSelect').val(),
                    fullCode: $('#fullCode').val()
                };

                console.log('Thông tin bố cục:', layoutInfo);
            }

            alert('Chức năng lưu đang được phát triển');
        });
    });
</script>
</body>
</html>